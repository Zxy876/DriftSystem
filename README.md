# DriftSystem - å¿ƒæ‚¦å®‡å®™

> å®Œå…¨è‡ªç„¶è¯­è¨€é©±åŠ¨çš„ AI å†’é™©æ¸¸æˆç³»ç»Ÿ

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

DriftSystemï¼ˆå¿ƒæ‚¦å®‡å®™ï¼‰æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ Minecraft æ¸¸æˆç³»ç»Ÿï¼Œå®ƒè®©ç©å®¶é€šè¿‡**çº¯è‡ªç„¶è¯­è¨€**ä¸æ¸¸æˆä¸–ç•Œäº¤äº’ï¼Œæ— éœ€è®°å¿†ä»»ä½•å‘½ä»¤ã€‚AIä¼šè‡ªåŠ¨ç†è§£ç©å®¶çš„æ„å›¾ï¼Œæ¨è¿›å‰§æƒ…ï¼Œä¿®æ”¹ä¸–ç•Œï¼Œç”šè‡³å¸®åŠ©ç©å®¶åˆ›ä½œæ–°çš„æ•…äº‹ã€‚

### æ ¸å¿ƒç†å¿µ

1. **å®Œå…¨è‡ªç„¶è¯­è¨€é©±åŠ¨** - è¯´è¯å³ç©æ¸¸æˆ
2. **å‰§æƒ…ä¸ä¸–ç•Œå…±ç”Ÿ** - æ•…äº‹è‡ªåŠ¨ç”Ÿæˆç¯å¢ƒ
3. **å¯æ‰©å±•å™äº‹ç³»ç»Ÿ** - äººäººéƒ½èƒ½åˆ›ä½œå…³å¡
4. **æ¸…æ™°çš„æ¶æ„** - æ’ä»¶æ˜¯å‰ç«¯ï¼Œåç«¯æ˜¯å¤§è„‘
5. **äº’åŠ¨å¼å‰§æƒ…** - ç©å®¶è¡Œä¸ºå½±å“æ•…äº‹èµ°å‘

## ğŸ® ç©æ³•æ¼”ç¤º

```
ç©å®¶: ä½ å¥½ï¼Œæˆ‘æƒ³å¼€å§‹å†’é™©
ç³»ç»Ÿ: ã€å¿ƒæ‚¦æ–‡é›† ç¬¬1ç«  - é£˜ç§»ã€‘
ç³»ç»Ÿ: äº”æœˆçš„èµ›äº‹å³å°†åˆ°æ¥...
[ä¸–ç•Œè‡ªåŠ¨æ¸²æŸ“ï¼šç™½å¤©ã€æ™´æœ—ã€NPCç”Ÿæˆ]

ç©å®¶: æŠŠå¤©æ°”æ”¹æˆä¸‹é›¨ç„¶åè·³åˆ°ç¬¬ä¸‰å…³
ç³»ç»Ÿ: âœ“ å¤©æ°”å·²æ”¹ä¸ºä¸‹é›¨
ç³»ç»Ÿ: âœ“ æ­£åœ¨ä¼ é€åˆ° level_03...
[è‡ªåŠ¨æ‰§è¡Œå¤šä¸ªåŠ¨ä½œ]

ç©å®¶: å†™ä¸€ä¸ªå…³äºæœˆå…‰ä¸‹çš„å†’é™©æ•…äº‹
ç³»ç»Ÿ: âœ¨ æ­£åœ¨åˆ›å»ºæ–°å‰§æƒ…...
ç³»ç»Ÿ: âœ… å‰§æƒ…åˆ›å»ºæˆåŠŸï¼
[ç©å®¶åˆ›ä½œçš„å…³å¡ç«‹å³å¯ç©]

ç©å®¶: æ˜¾ç¤ºåœ°å›¾
ç³»ç»Ÿ: [å±•ç¤ºå°åœ°å›¾]
      å½“å‰: level_03
      æ¨è: level_04
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Minecraft æœåŠ¡å™¨ (Paper)         â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   DriftSystem æ’ä»¶ (Java)     â”‚  â”‚
â”‚  â”‚   - è‡ªç„¶è¯­è¨€ç›‘å¬              â”‚  â”‚
â”‚  â”‚   - æ„å›¾è·¯ç”±åˆ†å‘              â”‚  â”‚
â”‚  â”‚   - ä¸–ç•ŒåŠ¨æ€æ¸²æŸ“              â”‚  â”‚
â”‚  â”‚   - å‰§æƒ…çŠ¶æ€ç®¡ç†              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†• HTTP                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    FastAPI åç«¯ (Python)             â”‚
â”‚   - AI æ„å›¾è¯†åˆ« (DeepSeek)           â”‚
â”‚   - å‰§æƒ…å¼•æ“ (30ä¸ªå¿ƒæ‚¦æ–‡é›†å…³å¡)       â”‚
â”‚   - ä¸–ç•ŒçŠ¶æ€ç®¡ç†                     â”‚
â”‚   - DSL æ³¨å…¥ç³»ç»Ÿ                     â”‚
â”‚   - å°åœ°å›¾ç³»ç»Ÿ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
DriftSystem/
â”œâ”€â”€ backend/                    # Python åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPI ä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ story_api.py   # å‰§æƒ…API (å«DSLæ³¨å…¥)
â”‚   â”‚   â”‚   â”œâ”€â”€ world_api.py   # ä¸–ç•Œäº¤äº’API
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ intent_engine.py  # AIæ„å›¾è¯†åˆ«
â”‚   â”‚   â”‚   â”œâ”€â”€ story/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ story_engine.py   # å‰§æƒ…å¼•æ“
â”‚   â”‚   â”‚   â””â”€â”€ world/
â”‚   â”‚   â”‚       â””â”€â”€ engine.py          # ä¸–ç•Œå¼•æ“
â”‚   â”‚   â””â”€â”€ routers/           # è·¯ç”±å™¨
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ heart_levels/      # 30ä¸ªå¿ƒæ‚¦æ–‡é›†å…³å¡ (JSON)
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ system/mc_plugin/          # Minecraft æ’ä»¶
â”‚   â”œâ”€â”€ src/main/java/com/driftmc/
â”‚   â”‚   â”œâ”€â”€ DriftPlugin.java          # ä¸»æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”‚   â””â”€â”€ BackendClient.java    # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ intent2/
â”‚   â”‚   â”‚   â”œâ”€â”€ IntentRouter2.java    # æ„å›¾è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ IntentDispatcher2.java # æ„å›¾åˆ†å‘
â”‚   â”‚   â”œâ”€â”€ listeners/
â”‚   â”‚   â”‚   â””â”€â”€ PlayerChatListener.java # èŠå¤©ç›‘å¬
â”‚   â”‚   â”œâ”€â”€ world/
â”‚   â”‚   â”‚   â””â”€â”€ WorldPatchExecutor.java # ä¸–ç•Œæ¸²æŸ“
â”‚   â”‚   â”œâ”€â”€ story/
â”‚   â”‚   â”‚   â””â”€â”€ StoryManager.java     # å‰§æƒ…ç®¡ç†
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â””â”€â”€ DriftCommand.java     # å‘½ä»¤ç³»ç»Ÿ
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ build.sh              # æ„å»ºè„šæœ¬
â”‚
â”œâ”€â”€ start_all.sh              # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ DEPLOYMENT.md             # éƒ¨ç½²æŒ‡å—
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.10+
- Java 17+
- Maven 3.6+
- Paper/Spigot 1.20.1

### ä¸€é”®å¯åŠ¨

```bash
./start_all.sh
```

è¿™ä¼šè‡ªåŠ¨:
1. âœ“ æ£€æŸ¥ç¯å¢ƒ
2. âœ“ å¯åŠ¨åç«¯æœåŠ¡
3. âœ“ ç¼–è¯‘MCæ’ä»¶
4. âœ“ éƒ¨ç½²æ’ä»¶åˆ°æœåŠ¡å™¨

ç„¶åæ‰‹åŠ¨å¯åŠ¨MCæœåŠ¡å™¨:
```bash
cd backend/server
java -Xmx4G -Xms2G -jar paper-*.jar
```

### æ‰‹åŠ¨å¯åŠ¨

#### 1. å¯åŠ¨åç«¯

```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

#### 2. æ„å»ºæ’ä»¶

```bash
cd system/mc_plugin
./build.sh
```

#### 3. é…ç½®

ç¼–è¾‘ `plugins/DriftSystem/config.yml`:
```yaml
backend_url: "http://127.0.0.1:8000"
```

#### 4. å¯åŠ¨MCæœåŠ¡å™¨

```bash
cd backend/server
java -Xmx4G -Xms2G -jar paper-1.20.1.jar
```

### éªŒè¯å®‰è£…

è¿›å…¥æ¸¸æˆå:
```
/drift status
```

åº”è¯¥çœ‹åˆ°ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ã€‚

ç„¶åå°è¯•:
```
ä½ å¥½
```

ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«æ„å›¾å¹¶å›åº”ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªç„¶è¯­è¨€é©±åŠ¨ âœ¨

**æ”¯æŒçš„æ„å›¾ç±»å‹:**
- å‰§æƒ…æ¨è¿›: "ç»§ç»­", "ä¸‹ä¸€æ­¥"
- å…³å¡è·³è½¬: "å»ç¬¬3å…³", "è·³åˆ°level_05"
- ä¸–ç•Œæ§åˆ¶: "æ”¹æˆç™½å¤©", "ä¸‹é›¨", "ä¼ é€"
- åˆ›å»ºå‰§æƒ…: "å†™ä¸€ä¸ªæ•…äº‹", "åˆ›å»ºå…³å¡"
- æŸ¥çœ‹ä¿¡æ¯: "æ˜¾ç¤ºåœ°å›¾", "æˆ‘åœ¨å“ª"
- å¤šæ„å›¾: "æ”¹æˆç™½å¤©ç„¶åè·³åˆ°ç¬¬ä¸‰å…³"

### 2. 30ä¸ªå¿ƒæ‚¦æ–‡é›†å…³å¡ ğŸ“š

å®Œæ•´çš„å™äº‹ä½“éªŒ:
- level_01: é£˜ç§»ï¼ˆæ•°å­¦betaç‰ˆï¼‰
- level_02 ~ level_30: æŒç»­çš„æ•…äº‹çº¿
- æ”¯æŒåˆ†æ”¯å‰§æƒ…
- ç©å®¶é€‰æ‹©å½±å“èµ°å‘

### 3. ä¸–ç•ŒåŠ¨æ€æ¸²æŸ“ ğŸŒ

**æ”¯æŒçš„æ“ä½œ:**
- æ—¶é—´æ§åˆ¶ (ç™½å¤©/å¤œæ™š)
- å¤©æ°”æ§åˆ¶ (æ™´/é›¨/é›·)
- ä¼ é€ç©å®¶
- ç”Ÿæˆå®ä½“/NPC
- å»ºé€ ç»“æ„
- ç²’å­æ•ˆæœ
- å£°éŸ³æ•ˆæœ
- è¯æ°´æ•ˆæœ

### 4. DSLæ³¨å…¥ç³»ç»Ÿ ğŸ“

ç©å®¶å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€åˆ›å»ºæ–°å…³å¡:
```
ç©å®¶: å†™ä¸€ä¸ªå…³äºæ˜Ÿç©ºçš„æ•…äº‹
```

ç³»ç»Ÿä¼š:
1. è°ƒç”¨AIç”Ÿæˆå‰§æƒ…
2. åˆ›å»ºJSONæ–‡ä»¶
3. æ³¨å…¥åˆ°å…³å¡ç³»ç»Ÿ
4. ç«‹å³å¯ç©

### 5. å°åœ°å›¾ç³»ç»Ÿ ğŸ—ºï¸

```
ç©å®¶: æ˜¾ç¤ºåœ°å›¾
ç³»ç»Ÿ: 
  å½“å‰å…³å¡: level_03
  æ¨èä¸‹ä¸€å…³: level_04
  å·²å®Œæˆ: level_01, level_02
```

## ğŸ”§ é…ç½®è¯´æ˜

### åç«¯é…ç½® (backend/.env)

```env
DEEPSEEK_API_KEY=sk-xxxxx
OPENAI_BASE_URL=https://api.deepseek.com/v1
OPENAI_MODEL=deepseek-chat
```

### æ’ä»¶é…ç½® (plugins/DriftSystem/config.yml)

```yaml
# åç«¯åœ°å€
backend_url: "http://127.0.0.1:8000"

# ç³»ç»Ÿè®¾ç½®
system:
  debug: false
  nlp_timeout: 30

# å‰§æƒ…ç³»ç»Ÿ
story:
  start_level: "level_01"
  auto_save_interval: 300

# ä¸–ç•Œè®¾ç½®
world:
  allow_world_modification: true
  allow_story_creation: true
  safe_teleport: true
```

## ğŸ“– APIæ–‡æ¡£

### åç«¯API

å¯åŠ¨åç«¯åè®¿é—®: http://127.0.0.1:8000/docs

ä¸»è¦æ¥å£:
- `POST /ai/intent` - æ„å›¾è¯†åˆ«
- `POST /story/load/{player_id}/{level_id}` - åŠ è½½å…³å¡
- `POST /story/inject` - åˆ›å»ºå‰§æƒ…
- `POST /world/apply` - ä¸–ç•Œäº¤äº’
- `GET /minimap/{player_id}` - å°åœ°å›¾

### MCæ’ä»¶å‘½ä»¤

- `/drift status` - æŸ¥çœ‹çŠ¶æ€
- `/drift sync` - åŒæ­¥è¿›åº¦
- `/drift debug` - è°ƒè¯•ä¿¡æ¯

## ğŸ¨ è‡ªå®šä¹‰å¼€å‘

### æ·»åŠ æ–°æ„å›¾

1. åç«¯ `intent_engine.py`:
```python
"intents": [
    {"type": "MY_INTENT", ...}
]
```

2. æ’ä»¶ `IntentType2.java`:
```java
MY_INTENT,
```

3. æ’ä»¶ `IntentDispatcher2.java`:
```java
case MY_INTENT:
    handleMyIntent(p, intent);
    break;
```

### åˆ›å»ºæ–°å…³å¡

åœ¨ `backend/data/heart_levels/` åˆ›å»ºJSON:
```json
{
  "id": "level_31",
  "title": "æ–°ç¯‡ç« ",
  "text": ["å‰§æƒ…å†…å®¹..."],
  "bootstrap_patch": {
    "mc": {
      "tell": "æ¬¢è¿",
      "weather": "clear",
      "time": "day"
    }
  }
}
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ’ä»¶æ— æ³•è¿æ¥åç«¯

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://127.0.0.1:8000/

# æ£€æŸ¥é…ç½®
cat plugins/DriftSystem/config.yml
```

### é—®é¢˜2: AIä¸å“åº”

```bash
# æ£€æŸ¥APIå¯†é’¥
cat backend/.env

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f backend/backend.log
```

### é—®é¢˜3: ä¸–ç•Œä¸å˜åŒ–

```yaml
# å¯ç”¨è°ƒè¯•æ¨¡å¼
system:
  debug: true
```

## ğŸ“Š æ€§èƒ½

- åç«¯å“åº”æ—¶é—´: < 2ç§’
- æ„å›¾è¯†åˆ«å‡†ç¡®ç‡: > 90%
- ä¸–ç•Œæ¸²æŸ“å»¶è¿Ÿ: < 100ms
- æ”¯æŒç©å®¶æ•°: 50+ (å•æœº)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼

- æäº¤Issue
- Pull Request
- åˆ›ä½œæ–°å…³å¡
- æ”¹è¿›AIæç¤ºè¯

## ğŸ“„ è®¸å¯

MIT License

## ğŸ‘¥ ä½œè€…

Xinyue - å¿ƒæ‚¦å®‡å®™åˆ›é€ è€…

## ğŸ™ è‡´è°¢

- Paper/Spigot ç¤¾åŒº
- FastAPI æ¡†æ¶
- DeepSeek AI
- æ‰€æœ‰æµ‹è¯•ç©å®¶

---

**è®©å‰§æƒ…åœ¨Minecraftä¸­è‡ªç„¶ç”Ÿé•¿** ğŸŒ±

**ä½“éªŒå®Œå…¨ç”±å¯¹è¯é©±åŠ¨çš„å†’é™©ä¹‹æ—…** ğŸš€
