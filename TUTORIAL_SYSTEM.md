# 新手教学系统 - 完整指南

## 📚 系统概述

### ✅ 核心功能

**交互式教学系统**
- 6步渐进式教学流程
- 自动检测玩家进度
- 实时奖励和反馈
- 教学关卡（tutorial_level）

**教学内容**
1. ✨ 欢迎&基础对话
2. 📖 自由对话系统
3. 🎭 剧情创造功能
4. ⏭ 剧情推进机制
5. 🚀 关卡跳转导航
6. 👥 NPC互动系统
7. 🗺 小地图查看
8. 🧭 任务日志面板（/questlog）

---

## 🎮 教学流程

### 加入前：任务日志速览

- 执行命令 `/questlog` 可随时查看当前章节的任务、阶段进度与奖励摘要。
- 每次进入新关卡或触发关键规则事件时，任务日志会自动刷新；阶段推进会在动作栏显示 `★ 阶段完成` 提示。
- 教学流程中推荐在每一步后提示玩家运行 `/questlog`，帮助他们理解里程碑与剩余目标。

### Step 1: 欢迎（WELCOME）

**触发方式：**
```
POST /tutorial/start/{player_id}
```

**玩家输入：**
```
你好
```
或
```
我准备好了
```

**系统响应：**
- ✓ 步骤完成提示
- 💡 使用提示：可随时用自然语言对话
- 🎵 音效：升级音效
- ➡️ 自动进入第二步

---

### Step 2: 自由对话（DIALOGUE）

**教学目标：** 让玩家理解AI能理解自然语言

**玩家输入示例：**
```
这里是什么地方？
你是谁？
我在哪里？
```

**触发关键词：** 什么、哪里、地方、是谁、怎么、为什么

**系统响应：**
- ✓ AI理解确认
- 🎁 奖励：50经验值
- 💡 提示：系统用AI理解意图
- ➡️ 进入第三步

---

### Step 3: 创造剧情（CREATE_STORY）

**教学目标：** 教会玩家生成AI故事

**玩家输入示例：**
```
写一个剧情
创造故事
生成一个冒险
```

**触发关键词：** 写、剧情、故事、创造、生成

**系统响应：**
- ✓ 剧情创造成功
- 🎁 奖励：100经验值
- 💡 提示：每次生成都独一无二
- ➡️ 进入第四步

---

### Step 4: 推进剧情（CONTINUE_STORY）

**教学目标：** 教会玩家推进对话

**玩家输入示例：**
```
继续
下一步
然后呢
```

**触发关键词：** 继续、下一步、next、然后

**系统响应：**
- ✓ 剧情推进成功
- 🎁 奖励：生命恢复效果（10秒）
- 💡 提示：选择影响故事走向
- ➡️ 进入第五步

---

### Step 5: 关卡跳转（JUMP_LEVEL）

**教学目标：** 教会玩家导航30个关卡

**玩家输入示例：**
```
跳到第一关
前往level_01
go to level 10
```

**触发关键词：** 跳、第、关、前往、go、level

**系统响应：**
- ✓ 关卡跳转学习完成
- 🎁 奖励：150经验值
- 💡 提示：30个关卡各有特色
- ➡️ 进入第六步

---

### Step 6: NPC互动（NPC_INTERACT）

**教学目标：** 教会玩家与NPC对话

**玩家输入示例：**
```
你好（对NPC说）
帮帮我
有什么任务？
```

**触发关键词：** 你好、hi、教、帮助、任务

**系统响应：**
- ✓ NPC互动学习完成
- 🎁 奖励：速度提升（10分钟）
- 💡 提示：关键词触发任务
- ➡️ 进入第七步

---

### Step 7: 查看地图（VIEW_MAP）

**教学目标：** 教会玩家查看进度

**玩家输入示例：**
```
给我小地图
查看地图
显示进度
```

**触发关键词：** 地图、map、小地图、进度

**系统响应：**
- ✓ 教学完成！
- 🎁 最终奖励：
  - 500经验值
  - 发光效果（10分钟）
  - 新手礼包：
    - 5颗钻石
    - 3个金苹果
    - 1本书
- 🎉 标题动画："教学完成！"
- 🎵 音效：挑战完成音效

---

## 🔧 API文档

### POST /tutorial/start/{player_id}
开始新手教学

**响应示例：**
```json
{
  "status": "ok",
  "message": "新手教学已开始",
  "tutorial": {
    "title": "§e✨ 欢迎来到心悦文集",
    "description": "这是一个由AI驱动的互动故事世界",
    "instruction": "§7请在聊天框输入：§f'你好'§7 或 §f'我准备好了'"
  },
  "mc": {
    "tell": [...],
    "title": {...},
    "sound": {...}
  }
}
```

---

### POST /tutorial/check
检查教学进度

**请求体：**
```json
{
  "player_id": "uuid",
  "message": "玩家输入的文字"
}
```

**响应（步骤完成）：**
```json
{
  "status": "ok",
  "result": {
    "status": "step_completed",
    "step": "welcome",
    "success_message": "§a✓ 很好！你已经学会了基本对话",
    "reward": {...},
    "next_step": {
      "title": "§b📖 第一课：自由对话",
      "description": "...",
      "instruction": "..."
    }
  },
  "mc": [...]
}
```

**响应（无进度）：**
```json
{
  "status": "no_progress",
  "message": "继续尝试吧"
}
```

---

### GET /tutorial/status/{player_id}
获取当前教学状态

**响应：**
```json
{
  "status": "ok",
  "current_step": {
    "title": "§b📖 第一课：自由对话",
    "description": "...",
    "instruction": "..."
  }
}
```

---

### GET /tutorial/hint/{player_id}
获取当前步骤提示

**响应：**
```json
{
  "status": "ok",
  "hint": "§b📖 第一课：自由对话\n§7试着问我...",
  "mc": {
    "tell": "§b💡 提示：\n..."
  }
}
```

---

### POST /tutorial/skip/{player_id}
跳过教学

**响应：**
```json
{
  "status": "ok",
  "message": "§7已跳过新手教学，祝你冒险愉快！",
  "mc": [...]
}
```

---

## 🎨 教学关卡配置

### tutorial_level.json

**位置：** `/backend/data/heart_levels/tutorial_level.json`

**关卡特色：**
- 📍 白色石英平台（12x12）
- 👤 NPC：心悦向导
- 🎵 音乐：cat（轻松旋律）
- ✨ 粒子：白色光点（end_rod）

**NPC行为：**
1. **站立** - 看向最近的玩家
2. **互动** - 右键显示完整教学信息
3. **任务** - 关键词触发"心悦之旅启程"

**NPC对话内容：**
```
§e✨[心悦向导]§r 欢迎来到心悦文集的世界！

§b📖 第一步：自由对话
§7试着在聊天框输入：§f'你好'

§b📖 第二步：创造剧情
§7输入：§f'写一个剧情'

§b📖 第三步：关卡跳转
§7输入：§f'跳到第一关'

§b📖 第四步：NPC互动
§7每个关卡都有独特的NPC

§b📖 第五步：查看地图
§7输入：§f'给我小地图'

§a准备好了吗？说§f'开始冒险'§a来开启你的旅程！
```

---

## 🧪 测试用例

### Test Case 1: 完整流程测试

```bash
# 1. 启动教学
curl -X POST "http://127.0.0.1:8000/tutorial/start/player1"

# 2. 步骤1：打招呼
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"你好"}'

# 3. 步骤2：提问
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"这里是什么地方"}'

# 4. 步骤3：创造剧情
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"写一个剧情"}'

# 5. 步骤4：推进
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"继续"}'

# 6. 步骤5：跳关
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"跳到第一关"}'

# 7. 步骤6：NPC互动
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"你好，NPC"}'

# 8. 步骤7：查看地图（完成）
curl -X POST "http://127.0.0.1:8000/tutorial/check" \
  -H "Content-Type: application/json" \
  -d '{"player_id":"player1","message":"给我小地图"}'
```

**预期结果：**
```
✓ 第一步: §a✓ 很好！你已经学会了基本对话
✓ 第二步: §a✓ 太棒了！AI理解了你的问题
✓ 第三步: §a✓ 精彩！你创造了自己的故事
✓ 第四步: §a✓ 完美！故事在你的选择中延续
✓ 第五步: §a✓ 厉害！你学会了快速导航
✓ 第六步: §a✓ 太好了！你与NPC建立了联系
✓ 第七步: §a✓ 完美！你已经掌握了所有基础功能
🎉 教学完成！
```

---

### Test Case 2: 中途查看状态

```bash
# 查看当前进度
curl "http://127.0.0.1:8000/tutorial/status/player1"

# 获取提示
curl "http://127.0.0.1:8000/tutorial/hint/player1"
```

---

### Test Case 3: 跳过教学

```bash
curl -X POST "http://127.0.0.1:8000/tutorial/skip/player1"
```

---

## 🎁 奖励清单

| 步骤 | 经验值 | 效果 | 物品 |
|------|--------|------|------|
| Step 1 | 0 | - | - |
| Step 2 | 50 | - | - |
| Step 3 | 100 | - | - |
| Step 4 | 0 | 生命恢复(10s) | - |
| Step 5 | 150 | - | - |
| Step 6 | 0 | 速度提升(10min) | - |
| Step 7 | 500 | 发光(10min) | 钻石x5, 金苹果x3, 书x1 |
| **总计** | **800** | **3种效果** | **3种物品** |

---

## 🚀 游戏内体验

### 玩家视角流程

**1. 进入服务器**
```
> 玩家加入游戏
> 系统检测到新玩家
> 自动开启教学
```

**2. 看到欢迎界面**
```
╔════════════════════════════════╗
║   ✨ 欢迎来到心悦文集 ✨      ║
║                                ║
║  这是一个由AI驱动的互动故事   ║
║                                ║
║  请在聊天框输入：'你好'       ║
║  或 '我准备好了'              ║
╚════════════════════════════════╝
```

**3. 开始互动**
```
[玩家] 你好
[系统] ✓ 很好！你已经学会了基本对话
[系统] 💡 提示：你可以随时用自然语言与系统对话
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📖 第一课：自由对话
试着问我：'这里是什么地方？'
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**4. 逐步学习**
- 每完成一步都有音效和视觉反馈
- 实时获得经验值和效果
- 清晰的下一步指引

**5. 完成教学**
```
╔════════════════════════════════╗
║      🎉 教学完成！             ║
║                                ║
║  你已经掌握了所有基础功能     ║
║                                ║
║  现在，开始你的冒险吧！       ║
║                                ║
║  💝 新手礼包已发放             ║
╚════════════════════════════════╝
```

---

## 📊 系统统计

- **教学步骤数**：7步
- **总教学时长**：约5-10分钟
- **总奖励经验**：800点
- **总奖励物品**：9个
- **触发关键词**：30+个
- **支持语言**：中文、英文

---

## 🔄 与主系统集成

### 自动触发时机

1. **首次进入服务器** - 自动启动教学
2. **输入特定关键词** - "教学"、"tutorial"、"帮助"
3. **NPC互动** - 心悦向导右键点击

### 教学完成后

- ✅ 解锁所有功能
- ✅ 可以自由探索30个关卡
- ✅ 获得新手礼包
- ✅ 教学状态保存

---

*生成时间: 2025-01-20*  
*教学系统版本: v1.0*  
*教学关卡: tutorial_level*  
*后端版本: v2.stage + Tutorial*
