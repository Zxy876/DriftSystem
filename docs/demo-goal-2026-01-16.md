
2026-01-16 · Drift 最小造物闭环 Demo（执行真相源）

本文件是本次 Demo 的唯一验收依据。
任何不满足本文档中“通过条件”的结果，均视为未完成。

⸻

🎯 目标定义（不可更改）

当玩家在聊天输入框中输入
“在我面前放一块紫水晶”
系统必须在玩家前方 1 格的世界坐标中
真实生成一个 minecraft:amethyst_block 方块。

该结果必须满足以下三点同时成立：
	1.	真实世界改变
	2.	执行日志可追溯
	3.	不经剧情系统写世界

⸻

✅ 验收通过标准（全部满足才算通过）

A. 执行层日志（后端）

后端日志中 必须出现且仅出现 以下日志之一（至少一条）：

[Drift][EXECUTED] setblock X Y Z minecraft:amethyst_block

	•	X Y Z 必须是玩家前方 1 格的解析坐标
	•	不接受仅有 [PlanExecutor] CREATE_BLOCK → … 而没有 [EXECUTED]

⸻

B. 世界可见性（玩家视角）
	•	玩家在游戏中 肉眼可见 对应位置出现紫水晶方块
	•	退出并重新进入世界后，该方块仍然存在

⸻

C. 写世界路径唯一性（强制约束）

本次 Demo 中：
	•	❌ 禁止 Narrative / StoryEngine / IdealCity / Transformer 直接返回 world_patch
	•	❌ 禁止 插件侧直接调用 setblock（除非作为 RCON 的执行端）
	•	✅ 唯一允许 的世界写入路径为：

Chat
 → Intent (PLACE_BLOCK)
 → CreationPlan
 → PatchTemplate (setblock)
 → PatchExecutor.dry_run
 → PlanExecutor.auto_execute
 → RCON
 → Minecraft World

若发现任何其他路径写世界，视为 Demo 失败。

⸻

🧩 前置条件（必须全部满足）
	•	后端虚拟环境可用（如 backend/.venv_phase21）
	•	RCON 配置正确：
	•	MINECRAFT_RCON_HOST
	•	MINECRAFT_RCON_PORT
	•	MINECRAFT_RCON_PASSWORD
	•	DriftSystem.jar 为本次代码对应版本，已放入：

backend/server/plugins/



⸻

🛠 实施步骤（严格顺序执行）

Step 1 · 后端：最小造物闭环接管

在 backend/app/services/creation_workflow.py 中：
	•	必须实现一个最小闭环逻辑，仅支持：
	•	单步 CREATE_BLOCK / PLACE_BLOCK
	•	单条 setblock 命令
	•	职责定义：
	•	解析聊天中传入的：
	•	minecraft:* 方块 ID
	•	绝对坐标（由插件提供）
	•	构造 单步 CreationPlan
	•	调用 PlanExecutor.auto_execute(plan)
	•	严禁：
	•	在此文件中生成叙事文本
	•	从剧情 Agent 接收或转发 world_patch

本文件在本次 Demo 中是执行真相源（Source of Execution Truth）。

⸻

Step 2 · 重启后端与服务器

./stop_all.sh   # 如有需要
./start_all.sh

确认：
	•	FastAPI 启动成功
	•	RCON 连接日志无报错
	•	Paper 服务器正常启动

⸻

Step 3 · 客户端准备
	•	使用测试账号进入服务器
	•	站在平坦区域
	•	确保玩家前方 1 格为空气

⸻

Step 4 · 发起聊天指令（唯一测试用例）

在聊天中输入：

在我面前放一块紫水晶

插件必须：
	•	解析玩家坐标与朝向
	•	计算前方 1 格的绝对坐标
	•	将以下信息发送给后端：
	•	block_id = minecraft:amethyst_block
	•	x, y, z（绝对坐标）

⸻

Step 5 · 执行验证（关键）

后端日志必须出现（至少一次）：

[PlanExecutor] CREATE_BLOCK → setblock X Y Z minecraft:amethyst_block
[Drift][EXECUTED] setblock X Y Z minecraft:amethyst_block

游戏内：
	•	在 (X, Y, Z) 处看到紫水晶方块

⸻

🧪 验证清单（逐条勾选）
	•	后端日志出现 [Drift][EXECUTED] setblock …
	•	方块在世界中肉眼可见
	•	未出现任何 Narrative / StoryEngine 写世界日志
	•	未出现 “剧情说放了，但世界没变” 的情况

⸻

📊 监控与日志位置
	•	后端：
	•	backend/logs/backend.log
	•	关键字：PlanExecutor、[Drift][EXECUTED]
	•	服务器：
	•	backend/server/logs/latest.log
	•	用于确认插件侧坐标解析与 RCON 调用

⸻

⚠️ 常见失败模式（一律视为未通过）
	•	❌ 日志显示“执行成功”，但世界中无方块
	•	❌ 只有剧情文本，没有 [EXECUTED]
	•	❌ 方块出现，但不是通过 PlanExecutor / RCON
	•	❌ 通过硬编码 / 插件直写实现

⸻

📦 交付物（必须提交）
	•	修改后的 creation_workflow.py
	•	一段完整日志（包含 EXECUTED）
	•	游戏内方块出现的截图或视频
	•	如需，附带环境变量与 RCON 配置说明

⸻

🧭 后续扩展（本次不做，但必须保留接口）
	•	ResourceCatalog 扩展为 mod / NPC / 结构
	•	多步 CreationPlan
	•	世界状态监听（Block → Entity → Narrative）

 