# DriftSystem 测试指南

## 功能测试清单

### ✅ 基础功能测试

#### 1. 系统启动测试
```
目标: 验证插件正常加载
步骤:
1. 启动MC服务器
2. 观察控制台输出
3. 查看是否有"DriftSystem 已启动"消息

预期: 
✓ 插件加载成功
✓ 后端连接正常
✓ 没有错误信息
```

#### 2. 命令系统测试
```
目标: 验证基础命令可用
步骤:
在游戏中执行: /drift status

预期:
✓ 显示玩家状态
✓ 显示当前关卡
✓ 没有报错
```

### ✅ 自然语言测试

#### 3. 基础对话测试
```
目标: 验证自然语言识别
步骤:
玩家说: 你好

预期:
✓ 系统识别为 SAY_ONLY 或 STORY_CONTINUE
✓ 有AI回复或剧情推进
✓ 响应时间 < 5秒
```

#### 4. 世界控制测试
```
测试用例1: 时间控制
输入: 改成白天
预期: ✓ 天空变亮, 时间设为day

测试用例2: 天气控制
输入: 下雨
预期: ✓ 开始下雨

测试用例3: 组合命令
输入: 把天气改成晴天然后设置为白天
预期: ✓ 两个动作都执行
```

#### 5. 关卡跳转测试
```
测试用例1: 数字跳转
输入: 去第3关
预期: 
✓ 传送到对应位置
✓ 加载 level_03 剧情
✓ 显示剧情文本

测试用例2: ID跳转
输入: 跳到level_05
预期: ✓ 同上
```

#### 6. 小地图测试
```
输入: 显示地图
或: 我在哪里

预期:
✓ 显示当前关卡
✓ 显示推荐下一关
✓ 显示已完成关卡
```

### ✅ 高级功能测试

#### 7. 剧情创建测试
```
输入: 写一个关于月光的故事

预期:
✓ 显示"正在创建..."
✓ AI生成剧情内容
✓ 创建JSON文件
✓ 显示"创建成功"
✓ 可以加载新关卡
```

#### 8. 多意图测试
```
输入: 改成白天并跳到第二关然后显示地图

预期:
✓ 执行所有3个意图
✓ 按顺序执行
✓ 每个都有反馈
```

#### 9. 剧情推进测试
```
步骤:
1. 加载 level_01
2. 说: 继续
3. 观察剧情

预期:
✓ 剧情向前推进
✓ 显示下一段文本
✓ 世界环境跟随变化
```

### ✅ 错误处理测试

#### 10. 网络错误测试
```
步骤:
1. 停止后端
2. 在游戏中说话

预期:
✓ 显示连接失败消息
✓ 不崩溃
✓ 使用fallback识别
```

#### 11. 无效关卡测试
```
输入: 跳到level_999

预期:
✓ 显示"关卡不存在"
✓ 不崩溃
✓ 玩家位置不变
```

### ✅ 性能测试

#### 12. 响应时间测试
```
测试: 连续发送10条消息
测量: 每条响应时间

预期:
✓ 平均 < 2秒
✓ 最大 < 5秒
✓ 没有超时
```

#### 13. 并发测试
```
测试: 多个玩家同时说话
玩家数: 5-10人

预期:
✓ 都能正常处理
✓ 没有串线
✓ 状态独立
```

## 自动化测试脚本

### 后端API测试

```bash
#!/bin/bash

echo "测试后端API..."

# 测试1: 健康检查
echo "1. 健康检查"
curl -s http://127.0.0.1:8000/ | jq .

# 测试2: 意图识别
echo "2. 意图识别"
curl -X POST http://127.0.0.1:8000/ai/intent \
  -H "Content-Type: application/json" \
  -d '{"player_id": "test", "text": "改成白天"}' | jq .

# 测试3: 关卡列表
echo "3. 关卡列表"
curl -s http://127.0.0.1:8000/levels | jq .

# 测试4: 加载关卡
echo "4. 加载关卡"
curl -X POST http://127.0.0.1:8000/story/load/test/level_01 | jq .

# 测试5: 创建剧情
echo "5. 创建剧情"
curl -X POST http://127.0.0.1:8000/story/inject \
  -H "Content-Type: application/json" \
  -d '{
    "level_id": "test_api",
    "title": "测试关卡",
    "text": "这是一个测试"
  }' | jq .

echo "✅ API测试完成"
```

### MC插件测试

在MC控制台执行:
```
# 测试命令
drift status
drift sync
drift debug

# 模拟玩家输入 (需要登录游戏)
# 你好
# 改成白天
# 跳到第三关
# 显示地图
```

## 测试数据

### 测试用户
- 用户名: TestPlayer1, TestPlayer2
- UUID: 自动生成

### 测试关卡
- level_01: 起始关卡
- level_test: 测试关卡
- custom_*: 动态创建的关卡

## 问题记录

### Issue Template

```
问题: [简述问题]
复现步骤:
1. 
2. 
3. 

预期行为: 
实际行为: 
错误日志: 
环境信息: 
```

## 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: 
环境: 
  - MC版本: 
  - Java版本: 
  - Python版本: 
  - 插件版本: 

测试结果:
  ✓ 通过: X/Y
  ✗ 失败: Z/Y
  
详细:
  [功能名称] - [通过/失败] - [备注]
  
性能:
  平均响应时间: X ms
  最大响应时间: Y ms
  并发玩家数: Z
  
问题:
  1. 
  2. 
  
建议:
  1. 
  2. 
```

## 持续测试

### 每日检查
- [ ] 后端健康检查
- [ ] 插件加载检查
- [ ] 基础命令测试

### 每周测试
- [ ] 完整功能测试
- [ ] 性能测试
- [ ] 新关卡测试

### 每月测试
- [ ] 压力测试
- [ ] 安全测试
- [ ] 兼容性测试

---

**测试驱动开发，确保系统稳定可靠** ✅
